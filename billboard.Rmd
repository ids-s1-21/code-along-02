---
title: "Code-along, Week 02: Billboard Hot 100"
author: "Alex Homer"
date: "23 September 2021"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(scales)
library(lubridate)
```

## Read data
The data are drawn from the "Tidy Tuesday" project: [2021 Week 38: Top 100 Billboard](https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-09-14/readme.md) (credit: [Data.World](https://data.world/kcmillersean/billboard-hot-100-1958-2017#), via Sean Miller, [Billboard.com](https://www.billboard.com/) and Spotify).  We have very lightly modified the data by converting the `week_id` column to a week that R can recognise.

```{r read-data, message = FALSE}
chart_data <- readRDS("data/billboard.rds")
chart_data %>%
  summarise(
    first_week = min(chart_date),
    last_week = max(chart_date)
  )
```

The data span from 2nd August 1958 (which according to [Wikipedia](https://en.wikipedia.org/wiki/Billboard_Hot_100#History) was the first Hot 100 chart, although Wikipedia has the date a couple of days later) to 29th May 2021.

The full dataset has a row (i.e. an observation) for every week and chart position, so any song that was on the charts for more than one week appears multiple times.  For example, if we take [one particular song](https://www.youtube.com/watch?v=dQw4w9WgXcQ)...

```{r give-you-up, message = FALSE}
never_gonna <- chart_data %>%
  filter(song == "Never Gonna Give You Up") %>%
  arrange(chart_date) %>%
  select(song, performer, chart_date, week_position)

never_gonna %>% print(n = dim(never_gonna)[1]) #Print all rows
```

... we see that it was on the chart for many weeks.  This allows us to plot the chart fortunes of this song:

```{r let-you-down, message = FALSE}
never_gonna %>% ggplot(aes(x = chart_date, y = week_position)) +
  geom_line() +
  scale_x_date(
    labels = date_format("%d %b %Y"),
    expand = expansion(0.05, c(0,10))
  ) +
  scale_y_reverse(breaks = c(1, 10*(1:10))) + #Lower number = higher chart position
  labs(
    x = "Date",
    y = "Chart position",
    title = "I just wanna tell you how I'm charting",
    subtitle = "Gotta make you understand",
    caption = "Source: Data.World via Sean Miller, Billboard.com and Spotify"
  ) +
  coord_cartesian(ylim = c(100, 1)) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank())
```

But this is probably a bit "too much data" for our purposes in this code-along, so I've summarised the data so that each song appears only once, with some useful statistics for each song.  I've then put the results in a new .rds file, which we now import.

```{r read-data-2, message = FALSE}
song_data <- readRDS("data/songs.rds")
```

Let's try a different song.

```{r one-republic}
chart_data %>% filter(song == "Counting Stars") %>%
  ggplot(aes(x = chart_date, y = week_position)) +
  geom_line() +
  scale_y_reverse()
```

## Songs
```{r least-danceable-song}
song_data %>% arrange(desc(danceability)) %>%
  select(song, performer, danceability)
```

```{r average-danceability-year}
song_data <- song_data %>%
  mutate(song_year = year(first_appearance))

song_data %>%
  group_by(song_year) %>%
  summarise(average_dance = mean(danceability, na.rm = TRUE)) %>%
  ggplot(aes(x = song_year, y = average_dance)) +
  geom_line()
```

```{r 2010}
song_data %>% filter(song_year == 2010) %>%
  arrange(danceability) %>%
  select(song, performer, danceability)
```